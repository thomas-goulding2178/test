<!DOCTYPE html>
<html>
<head>
	<title>Ping Pong Game</title>
</head>
<body>
	<canvas id="canvas" width="800" height="400" style="border:1px solid #000000;"></canvas>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript">
		var HEIGHT;
		var WIDTH;
		var OLDHEIGHT;
		var OLDWIDTH;
		var paused = true;
		

		OLDWIDTH = WIDTH;
		OLDHEIGHT = HEIGHT;
		WIDTH = window.innerWidth;
		HEIGHT = window.innerHeight;
		if (WIDTH > 2 * HEIGHT)
			WIDTH = 2 * HEIGHT;
		else 
			HEIGHT = 0.5 * WIDTH;
		canvas.width = WIDTH;
		canvas.height = HEIGHT;
		app.width = WIDTH;
		app.height = HEIGHT;

		window.addEventListener('resize',function(){
			OLDWIDTH = WIDTH;
			OLDHEIGHT = HEIGHT;
			WIDTH = window.innerWidth;
			HEIGHT = window.innerHeight;
			if (WIDTH > 2 * HEIGHT)
				WIDTH = 2 * HEIGHT;
			else 
				HEIGHT = 0.5 * WIDTH;
			canvas.width = WIDTH;
			canvas.height = HEIGHT;

	
			app.width = WIDTH;
			app.height = HEIGHT;
			app.getNode('LeftPaddle').x = WIDTH*0.125;
			app.getNode('RightPaddle').x = WIDTH*0.875;
			app.getNode('LeftPaddle').y *= HEIGHT/OLDHEIGHT;
			app.getNode('RightPaddle').y *= HEIGHT/OLDHEIGHT;
			app.getNode('ball').x *= WIDTH/OLDWIDTH;
			app.getNode('ball').y *= HEIGHT/OLDHEIGHT;
			app.getNode('ball').width *= WIDTH/OLDWIDTH;
			app.getNode('ball').height *= HEIGHT/OLDHEIGHT;
			app.getNode('ball').speedx = WIDTH/200;
			app.getNode('ball').speedy = HEIGHT/125;
			app.getNode('LeftPaddle').width *= WIDTH/OLDWIDTH;
			app.getNode('LeftPaddle').height *= HEIGHT/OLDHEIGHT;
			app.getNode('RightPaddle').width *= WIDTH/OLDWIDTH;
			app.getNode('RightPaddle').height *= HEIGHT/OLDHEIGHT;
			
			
		});
		
		ResizeWindow = function(){	
			WIDTH = window.innerWidth;
			HEIGHT = window.innerHeight;
			if (WIDTH > 2 * HEIGHT)
				WIDTH = 2 * HEIGHT;
			else 
				HEIGHT = 0.5 * WIDTH;
			canvas.width = WIDTH;
			canvas.height = HEIGHT;
		}
		
		UpdatePlayerPositions = function(){	
				if(app.getNode('RightPaddle').pressingDown)
					app.getNode('RightPaddle').y += HEIGHT/75;	
				if(app.getNode('RightPaddle').pressingUp)
					app.getNode('RightPaddle').y -= HEIGHT/75;	
				if(app.getNode('LeftPaddle').pressingDown)
					app.getNode('LeftPaddle').y += HEIGHT/75;	
				if(app.getNode('LeftPaddle').pressingUp)
					app.getNode('LeftPaddle').y -= HEIGHT/75;	
				if (app.getNode('LeftPaddle').y < 0)
					app.getNode('LeftPaddle').y = 0;
				if (app.getNode('LeftPaddle').y + app.getNode('LeftPaddle').height > HEIGHT)
					app.getNode('LeftPaddle').y = HEIGHT - app.getNode('LeftPaddle').height;
				if (app.getNode('RightPaddle').y < 0)
					app.getNode('RightPaddle').y = 0;
				if (app.getNode('RightPaddle').y + app.getNode('RightPaddle').height > HEIGHT)
					app.getNode('RightPaddle').y = HEIGHT - app.getNode('RightPaddle').height;		
		};
		
		CheckCollisionPaddles = function(){
				if (app.getNode('ball').y > app.getNode('RightPaddle').y && app.getNode('ball').y < app.getNode('RightPaddle').y + app.getNode('RightPaddle').height){
					if (app.getNode('ball').x + app.getNode('ball').width > app.getNode('RightPaddle').x && app.getNode('ball').x + app.getNode('ball').width < app.getNode('RightPaddle').x + app.getNode('ball').speedx + 1){
						app.getNode('ball').speedx = -Math.abs(app.getNode('ball').speedx)
					}
				}
				
				if (app.getNode('ball').y > app.getNode('LeftPaddle').y && app.getNode('ball').y < app.getNode('LeftPaddle').y + app.getNode('LeftPaddle').height){
					if (app.getNode('ball').x < app.getNode('LeftPaddle').x + app.getNode('LeftPaddle').width && app.getNode('ball').x > app.getNode('LeftPaddle').x + app.getNode('LeftPaddle').width + app.getNode('ball').speedx - 1){
						app.getNode('ball').speedx = Math.abs(app.getNode('ball').speedx)
					}
				}
		};
		
		UpdateBallPosition = function(){
			CheckCollisionPaddles();
			app.getNode('ball').x += app.getNode('ball').speedx
			app.getNode('ball').y += app.getNode('ball').speedy
			if (app.getNode('ball').y < 0 || app.getNode('ball').y > HEIGHT - app.getNode('ball').height){
				app.getNode('ball').speedy = -app.getNode('ball').speedy
			}
			if (app.getNode('ball').x < 0 || app.getNode('ball').x + app.getNode('ball').width > WIDTH){
				app.reset();
			}
		};
		
		CheckKeyPress = function(){
			document.onkeydown = function(event){
				if(event.keyCode === 40)	//downarrow
					app.getNode('RightPaddle').pressingDown = true;
				else if(event.keyCode === 38) // uparrow
					app.getNode('RightPaddle').pressingUp = true;
				else if(event.keyCode === 83)	//s
					app.getNode('LeftPaddle').pressingDown = true;
				else if(event.keyCode === 87) // w
					app.getNode('LeftPaddle').pressingUp = true;
			}
		};
		
		CheckKeyRelease = function(){
			document.onkeyup = function(event){
				if(event.keyCode === 40)	//downarrow
					app.getNode('RightPaddle').pressingDown = false;
				else if(event.keyCode === 38) // uparrow
					app.getNode('RightPaddle').pressingUp = false;
				else if(event.keyCode === 83)	//s
					app.getNode('LeftPaddle').pressingDown = false;
				else if(event.keyCode === 87) // w
					app.getNode('LeftPaddle').pressingUp = false;
				else if(event.keyCode === 32) // w
					app.pause();
			}
		};			
		
		app.pause = function(){
			paused = !paused;
		};
		
		app.reset = function(){
			app.getNode('LeftPaddle').y = HEIGHT*0.375;
			app.getNode('RightPaddle').y = HEIGHT*0.375;
			app.getNode('ball').x = WIDTH*0.5;
			app.getNode('ball').y = HEIGHT*0.5;
			paused = true;
		};
		
		app.onInit = function(){
			this.nodes.push({
				id : 'LeftPaddle',
				x  : WIDTH*0.125,
				y  : HEIGHT*0.375,
				width  : WIDTH*0.0125,
				height : HEIGHT*0.25,
				color  : 'black',
				pressingLeft : false,
				pressingRight : false,
				pressingUp : false,
				pressingDown : false,
			});

			this.nodes.push({
				id : 'RightPaddle',
				x  : WIDTH*0.875,
				y  : HEIGHT*0.375,
				width  : WIDTH*0.0125,
				height : HEIGHT*0.25,
				color  : 'black',
				pressingLeft : false,
				pressingRight : false,
				pressingUp : false,
				pressingDown : false,
			});
			
			this.nodes.push = ({
				id : 'ball',
				x  : WIDTH*0.5,
				y  : HEIGHT*0.5,
				width  : WIDTH*0.0125,
				height : HEIGHT*0.025,
				color  : 'red',
				speedx : WIDTH/200,
				speedy : HEIGHT/125,
			});
		};

 		app.onUpdate = function(time){
			CheckKeyPress();
			CheckKeyRelease();
			if(paused){
				return
			}
			UpdatePlayerPositions(); 
			UpdateBallPosition();			
		}; 
	</script>
</body>
</html>