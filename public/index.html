<!DOCTYPE html>
<html>
<head>
	<title>Ping Pong Game</title>
</head>
<body>
	<canvas id="canvas" width="800" height="400" style="border:1px solid #000000;"></canvas>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript">
		
		var HEIGHT = 400
		var WIDTH = 800
		
		UpdatePlayerPositions = function(){				
			if(app.getNode('RightPaddle').pressingDown)
				app.getNode('RightPaddle').y += 2;	
			if(app.getNode('RightPaddle').pressingUp)
				app.getNode('RightPaddle').y -= 2;	
			if(app.getNode('LeftPaddle').pressingDown)
				app.getNode('LeftPaddle').y += 2;	
			if(app.getNode('LeftPaddle').pressingUp)
				app.getNode('LeftPaddle').y -= 2;	
			if (app.getNode('LeftPaddle').y < 0)
				app.getNode('LeftPaddle').y = 0;
			if (app.getNode('LeftPaddle').y + app.getNode('LeftPaddle').height > HEIGHT)
				app.getNode('LeftPaddle').y = HEIGHT - app.getNode('LeftPaddle').height;
			if (app.getNode('RightPaddle').y < 0)
				app.getNode('RightPaddle').y = 0;
			if (app.getNode('RightPaddle').y + app.getNode('RightPaddle').height > HEIGHT)
				app.getNode('RightPaddle').y = HEIGHT - app.getNode('RightPaddle').height;
		};
		
		CheckCollisionPaddles = function(){
				if (app.getNode('ball').y > app.getNode('RightPaddle').y && app.getNode('ball').y < app.getNode('RightPaddle').y + app.getNode('RightPaddle').height){
					if (app.getNode('ball').x + app.getNode('ball').width > app.getNode('RightPaddle').x && app.getNode('ball').x + app.getNode('ball').width < app.getNode('RightPaddle').x + app.getNode('ball').speedx + 1){
						app.getNode('ball').speedx = -Math.abs(app.getNode('ball').speedx)
					}
				}
				
				if (app.getNode('ball').y > app.getNode('LeftPaddle').y && app.getNode('ball').y < app.getNode('LeftPaddle').y + app.getNode('LeftPaddle').height){
					if (app.getNode('ball').x < app.getNode('LeftPaddle').x + app.getNode('LeftPaddle').width && app.getNode('ball').x > app.getNode('LeftPaddle').x + app.getNode('LeftPaddle').width + app.getNode('ball').speedx - 1){
						app.getNode('ball').speedx = Math.abs(app.getNode('ball').speedx)
					}
				}
		};
		
		UpdateBallPosition = function(){
			CheckCollisionPaddles();
			app.getNode('ball').x += app.getNode('ball').speedx
			app.getNode('ball').y += app.getNode('ball').speedy
			if (app.getNode('ball').y < 0 || app.getNode('ball').y > HEIGHT - app.getNode('ball').height){
				app.getNode('ball').speedy = -app.getNode('ball').speedy
			}
			if (app.getNode('ball').x < 0 || app.getNode('ball').x + app.getNode('ball').width > WIDTH){
				app.reset();
			}
		};
		
		CheckKeyPress = function(){
			document.onkeydown = function(event){
				if(event.keyCode === 40)	//downarrow
					app.getNode('RightPaddle').pressingDown = true;
				else if(event.keyCode === 38) // uparrow
					app.getNode('RightPaddle').pressingUp = true;
				else if(event.keyCode === 83)	//s
					app.getNode('LeftPaddle').pressingDown = true;
				else if(event.keyCode === 87) // w
					app.getNode('LeftPaddle').pressingUp = true;
			}
		};
		
		CheckKeyRelease = function(){
			document.onkeyup = function(event){
				if(event.keyCode === 40)	//downarrow
					app.getNode('RightPaddle').pressingDown = false;
				else if(event.keyCode === 38) // uparrow
					app.getNode('RightPaddle').pressingUp = false;
				else if(event.keyCode === 83)	//s
					app.getNode('LeftPaddle').pressingDown = false;
				else if(event.keyCode === 87) // w
					app.getNode('LeftPaddle').pressingUp = false;
			}
		};			
		
		
		
		app.reset = function(){
			app.getNode('LeftPaddle').y = 150;
			app.getNode('RightPaddle').y = 150;
			app.getNode('ball').x = 395;
			app.getNode('ball').y = 195;
			app.getNode('ball').speedx = 5;
			app.getNode('ball').speedy = 1;
		};
		
		app.onInit = function(){
			this.nodes.push({
				id : 'LeftPaddle',
				x  : 100,
				y  : 150,
				width  : 10,
				height : 100,
				color  : 'black',
				pressingLeft : false,
				pressingRight : false,
				pressingUp : false,
				pressingDown : false,
			});

			this.nodes.push({
				id : 'RightPaddle',
				x  : 690,
				y  : 150,
				width  : 10,
				height : 100,
				color  : 'black',
				pressingLeft : false,
				pressingRight : false,
				pressingUp : false,
				pressingDown : false,
			});
			
			this.nodes.push = ({
				id : 'ball',
				x  : 395,
				y  : 195,
				width  : 10,
				height : 10,
				color  : 'red',
				speedx : 5,
				speedy : 1,
			});
		};

 		app.onUpdate = function(time){
		
			CheckKeyPress();
			CheckKeyRelease();
			UpdatePlayerPositions(); 
			UpdateBallPosition();			
		}; 
	</script>
</body>
</html>